<!DOCTYPE html>
<html>
<head>
 <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS --> 
 	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- sbb CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/style.css}">
    <title>Hello, sbb!</title>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8g3puZvvTmx1LUzb2ukZq584A77cZP30"></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=442ed47d725b683fe859c5a0df08666a&libraries=services"></script>
    <style>
        #map {
            width: 500px;
            height: 350px;
        }
        #roadview {
            width: 500px;
            height: 300px;
        }
        #map2 {
            height: 500px;
            width: 100%;
        }
    </style>
    <script>
        function initKakaoMap() {
            var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
                mapOption = {
                    center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                    level: 3 // 지도의 확대 레벨
                };  

            var roadviewContainer = document.getElementById('roadview'); //로드뷰를 표시할 div
            var roadview = new kakao.maps.Roadview(roadviewContainer); //로드뷰 객체
            var roadviewClient = new kakao.maps.RoadviewClient(); //좌표로부터 로드뷰 파노ID를 가져올 로드뷰 helper객체

            var position = new kakao.maps.LatLng(33.450701, 126.570667);

            // 특정 위치의 좌표와 가까운 로드뷰의 panoId를 추출하여 로드뷰를 띄운다.
            roadviewClient.getNearestPanoId(position, 50, function(panoId) {
                roadview.setPanoId(panoId, position); //panoId와 중심좌표를 통해 로드뷰 실행
            });

            // 지도를 생성합니다    
            var map = new kakao.maps.Map(mapContainer, mapOption); 

            // 주소-좌표 변환 객체를 생성합니다
            var geocoder = new kakao.maps.services.Geocoder();

            // 주소로 좌표를 검색합니다
            geocoder.addressSearch('[[${question.addr}]]', function(result, status) {
                // 정상적으로 검색이 완료됐으면 
                if (status === kakao.maps.services.Status.OK) {
                    var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                    // 결과값으로 받은 위치를 마커로 표시합니다
                    var marker = new kakao.maps.Marker({
                        map: map,
                        position: coords
                    });

                    // 인포윈도우로 장소에 대한 설명을 표시합니다
                    var infowindow = new kakao.maps.InfoWindow({
                        content: '<div style="width:150px;text-align:center;padding:6px 0;">[[${question.subject}]]</div>'
                    });
                    infowindow.open(map, marker);

                    // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                    map.setCenter(coords);
                } 
            });
        }

        function initGoogleMap() {
            var location = { lat: 37.5666805, lng: 126.9784147 }; // 예시 좌표
            var map2 = new google.maps.Map(document.getElementById('map2'), {
                zoom: 20,
                center: location
            });
            var marker = new google.maps.Marker({
                position: location,
                map: map2
            });
        }
        
        function initMaps() {
            initKakaoMap();
            initGoogleMap();
        }
    </script>
</head>
<body onload="initMaps()">
    <div class="container my-3">
        <h1 th:text="${question.subject}"></h1>
        <div th:text="${question.addr}"></div>
        <div th:text="${question.content}"></div>
        <img th:src="|${downpath}/${question.image1}|">
        <div style="display: flex; justify-content: space-between;">
            <div id="map"></div>
            <div id="roadview"></div>
        </div>
        <div id="map2"></div>
        <a th:href="@{|/question/delete/${question.id}|}" class="btn btn-danger">삭제</a>
        <a th:href="@{|/question/update/${question.id}|}" class="btn btn-primary">수정</a>
        <h5 th:text="|${#lists.size(question.answerList)}개의 답변이 있습니다.|"></h5>
        <ul>
            <li th:each="answer : ${question.answerList}" th:text="${answer.content}"></li>
        </ul>
        <form th:action="@{|/answer/create/${question.id}|}" method="post" enctype="multipart/form-data">
            <textarea name="content" id="content" rows="15"></textarea>
            <input type="submit" value="답변등록">
        </form>
    </div>
</body>
</html>